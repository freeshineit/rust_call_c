# build.rs å¯è§†åŒ–æŒ‡å—

## ğŸ“¦ æ–‡ä»¶ç»“æ„

```
call_c_static/
â”‚
â”œâ”€â”€ ğŸ“„ build.rs                    â† æ„å»ºè„šæœ¬ï¼ˆæœ¬æ–‡æ¡£é‡ç‚¹ï¼‰
â”‚   â””â”€â”€ ä½œç”¨ï¼šé…ç½®é“¾æ¥å™¨å‚æ•°
â”‚
â”œâ”€â”€ ğŸ“ c_static_libs/              â† é™æ€åº“ç›®å½•
â”‚   â”œâ”€â”€ hello.c                    â† C æºæ–‡ä»¶
â”‚   â””â”€â”€ libhello.a                 â† ç¼–è¯‘åçš„é™æ€åº“ â­
â”‚
â””â”€â”€ ğŸ“ src/
    â””â”€â”€ main.rs                    â† Rust ä¸»ç¨‹åº
        â””â”€â”€ è°ƒç”¨ C å‡½æ•° hello()
```

## ğŸ”„ build.rs æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cargo build -p call_c_static                            â”‚
â”‚  (ç”¨æˆ·æ‰§è¡Œå‘½ä»¤)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: è¿è¡Œ build.rs                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ let current_dir = env::current_dir().unwrap();    â”‚  â”‚
â”‚  â”‚ // è·å–: /path/to/call_c_static                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: æ„å»ºåº“è·¯å¾„                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ let lib_path = current_dir.join("c_static_libs"); â”‚  â”‚
â”‚  â”‚ // ç»“æœ: /path/to/call_c_static/c_static_libs     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: å‘é€æŒ‡ä»¤ç»™ cargo                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ println!("cargo:rustc-link-search=native=...");   â”‚  â”‚
â”‚  â”‚ println!("cargo:rustc-link-lib=static=hello");    â”‚  â”‚
â”‚  â”‚ println!("cargo:rerun-if-changed=...");           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: cargo æ¥æ”¶æŒ‡ä»¤å¹¶ä¼ é€’ç»™ç¼–è¯‘å™¨                     â”‚
â”‚                                                          â”‚
â”‚  rustc src/main.rs \                                     â”‚
â”‚    -L native=/path/to/c_static_libs \                    â”‚
â”‚    -l static=hello                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: é“¾æ¥å™¨å·¥ä½œ                                      â”‚
â”‚                                                          â”‚
â”‚  1. åœ¨ c_static_libs/ ç›®å½•æŸ¥æ‰¾ libhello.a               â”‚
â”‚  2. æå– hello() å‡½æ•°çš„æœºå™¨ç                             â”‚
â”‚  3. åˆå¹¶åˆ°æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶                                        â”‚
â”‚                                                          â”‚
â”‚  target/debug/call_c_static                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸‰ä¸ªå…³é”®æŒ‡ä»¤è¯¦è§£

### 1ï¸âƒ£ æŒ‡å®šåº“æœç´¢è·¯å¾„

```rust
println!("cargo:rustc-link-search=native={}", lib_path.to_str().unwrap());
```

**ä½œç”¨**ï¼šå‘Šè¯‰é“¾æ¥å™¨"å»è¿™ä¸ªç›®å½•æ‰¾åº“æ–‡ä»¶"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é“¾æ¥å™¨                                  â”‚
â”‚                                         â”‚
â”‚  "æˆ‘éœ€è¦æ‰¾ libhello.aï¼Œå»å“ªé‡Œæ‰¾ï¼Ÿ"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  build.rs å›ç­”ï¼š                         â”‚
â”‚                                         â”‚
â”‚  "å» /path/to/c_static_libs ç›®å½•æ‰¾ï¼"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç­‰ä»·å‘½ä»¤**ï¼š
```bash
rustc -L native=/path/to/c_static_libs
```

---

### 2ï¸âƒ£ æŒ‡å®šè¦é“¾æ¥çš„åº“

```rust
println!("cargo:rustc-link-lib=static=hello");
```

**ä½œç”¨**ï¼šå‘Šè¯‰é“¾æ¥å™¨"é“¾æ¥åä¸º hello çš„é™æ€åº“"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é“¾æ¥å™¨                                  â”‚
â”‚                                         â”‚
â”‚  "æˆ‘è¦é“¾æ¥å“ªä¸ªåº“ï¼Ÿ"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  build.rs å›ç­”ï¼š                         â”‚
â”‚                                         â”‚
â”‚  "é“¾æ¥é™æ€åº“ hello"                      â”‚
â”‚  (è‡ªåŠ¨æŸ¥æ‰¾ libhello.a)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åº“åè½¬æ¢è§„åˆ™**ï¼š

| ä½ å†™çš„ | Linux/macOS æŸ¥æ‰¾ | Windows æŸ¥æ‰¾ |
|--------|-----------------|-------------|
| `hello` | `libhello.a` | `hello.lib` |
| `ssl` | `libssl.a` | `ssl.lib` |
| `mylib` | `libmylib.a` | `mylib.lib` |

**ç­‰ä»·å‘½ä»¤**ï¼š
```bash
rustc -l static=hello
```

---

### 3ï¸âƒ£ ä¼˜åŒ–é‡æ–°æ„å»º

```rust
println!("cargo:rerun-if-changed=c_static_libs/libhello.a");
```

**ä½œç”¨**ï¼šåªåœ¨é™æ€åº“æ”¹å˜æ—¶é‡æ–°è¿è¡Œ build.rs

```
ç¬¬ä¸€æ¬¡æ„å»ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cargo build                            â”‚
â”‚  â†’ è¿è¡Œ build.rs âœ…                      â”‚
â”‚  â†’ ç¼–è¯‘ main.rs                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒæ¬¡æ„å»ºï¼ˆlibhello.a æœªæ”¹å˜ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cargo build                            â”‚
â”‚  â†’ è·³è¿‡ build.rs âš¡ (ä¼˜åŒ–ï¼)             â”‚
â”‚  â†’ ç¼–è¯‘ main.rs                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰æ¬¡æ„å»ºï¼ˆlibhello.a æ”¹å˜äº†ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cargo build                            â”‚
â”‚  â†’ è¿è¡Œ build.rs âœ…                      â”‚
â”‚  â†’ ç¼–è¯‘ main.rs                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— é“¾æ¥è¿‡ç¨‹è¯¦è§£

### ç¼–è¯‘å‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.rs     â”‚         â”‚  libhello.a  â”‚
â”‚              â”‚         â”‚              â”‚
â”‚ extern "C" { â”‚         â”‚ void hello() â”‚
â”‚   fn hello();â”‚         â”‚ {            â”‚
â”‚ }            â”‚         â”‚   printf();  â”‚
â”‚              â”‚         â”‚ }            â”‚
â”‚ fn main() {  â”‚         â”‚              â”‚
â”‚   hello();   â”‚  âŒ     â”‚              â”‚
â”‚ }            â”‚  æœªé“¾æ¥  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼–è¯‘åï¼ˆé“¾æ¥æˆåŠŸï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  call_c_static (å¯æ‰§è¡Œæ–‡ä»¶)             â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  main()      â”‚  â”‚  hello()     â”‚   â”‚
â”‚  â”‚  {           â”‚  â”‚  {           â”‚   â”‚
â”‚  â”‚    hello(); â”€â”¼â”€â”€â†’  printf();  â”‚   â”‚
â”‚  â”‚  }           â”‚  â”‚  }           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   æ¥è‡ª main.rs      æ¥è‡ª libhello.a    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  hello.c    â”‚  C æºæ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ gcc -c
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  hello.o    â”‚  ç›®æ ‡æ–‡ä»¶ï¼ˆæœºå™¨ç ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ar rcs
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ libhello.a  â”‚  é™æ€åº“ï¼ˆæ‰“åŒ…çš„ .o æ–‡ä»¶ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ build.rs é…ç½®é“¾æ¥
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.rs    â”‚  Rust æºæ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ rustc + é“¾æ¥å™¨
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ call_c_     â”‚  æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶
â”‚ static      â”‚  (åŒ…å« Rust ä»£ç  + C ä»£ç )
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å…³é”®æ¦‚å¿µ

### é™æ€é“¾æ¥ vs åŠ¨æ€é“¾æ¥

```
é™æ€é“¾æ¥ (static):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯æ‰§è¡Œæ–‡ä»¶                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Rust   â”‚  â”‚ C ä»£ç  â”‚          â”‚
â”‚  â”‚ ä»£ç    â”‚  â”‚ (å¤åˆ¶) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… ä¼˜ç‚¹ï¼šç‹¬ç«‹è¿è¡Œï¼Œæ— éœ€å¤–éƒ¨åº“
âŒ ç¼ºç‚¹ï¼šæ–‡ä»¶è¾ƒå¤§

åŠ¨æ€é“¾æ¥ (dylib):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯æ‰§è¡Œæ–‡ä»¶   â”‚      â”‚  libhello.so â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Rust   â”‚  â”‚ â”€â”€â”€â†’ â”‚  â”‚ C ä»£ç  â”‚  â”‚
â”‚  â”‚ ä»£ç    â”‚  â”‚ å¼•ç”¨  â”‚  â”‚        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… ä¼˜ç‚¹ï¼šæ–‡ä»¶è¾ƒå°ï¼Œå¯å…±äº«
âŒ ç¼ºç‚¹ï¼šéœ€è¦è¿è¡Œæ—¶æ‰¾åˆ° .so æ–‡ä»¶
```

### extern "C" çš„ä½œç”¨

```
C å‡½æ•°:
void hello() { ... }
â†“
ç¬¦å·å: hello

C++ å‡½æ•° (æ—  extern "C"):
void hello() { ... }
â†“
ç¬¦å·å: _Z5hellov (name mangling)

C++ å‡½æ•° (æœ‰ extern "C"):
extern "C" void hello() { ... }
â†“
ç¬¦å·å: hello âœ… (Rust å¯ä»¥æ‰¾åˆ°)
```

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ build.rs è¾“å‡º

```bash
cargo build -p call_c_static -vv
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[call_c_static 0.1.0] cargo:rustc-link-search=native=/path/to/c_static_libs
[call_c_static 0.1.0] cargo:rustc-link-lib=static=hello
[call_c_static 0.1.0] cargo:rerun-if-changed=c_static_libs/libhello.a
```

### æŸ¥çœ‹é™æ€åº“å†…å®¹

```bash
nm c_static_libs/libhello.a
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
hello.o:
0000000000000000 T _hello    â† è¿™æ˜¯æˆ‘ä»¬è¦é“¾æ¥çš„å‡½æ•°
                 U _printf   â† hello å‡½æ•°ä¾èµ–çš„å¤–éƒ¨å‡½æ•°
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“– [BUILD_SCRIPT_EXPLAINED.md](BUILD_SCRIPT_EXPLAINED.md) - é€è¡Œä»£ç è§£æ
- ğŸ”„ [WORKFLOW.md](WORKFLOW.md) - å®Œæ•´å·¥ä½œæµç¨‹
- âš¡ [QUICK_REFERENCE.md](QUICK_REFERENCE.md) - å¿«é€Ÿå‚è€ƒ
- ğŸ“ [c_static_libs/README.md](c_static_libs/README.md) - é™æ€åº“è¯´æ˜

## ğŸ’¡ è®°å¿†å£è¯€

```
build.rs ä¸‰ä»¶äº‹ï¼š
1. å‘Šè¯‰åœ¨å“ªæ‰¾ (link-search)
2. å‘Šè¯‰é“¾æ¥å•¥ (link-lib)
3. å‘Šè¯‰ä½•æ—¶è·‘ (rerun-if-changed)
```
